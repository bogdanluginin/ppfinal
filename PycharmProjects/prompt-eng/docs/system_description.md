# Опис Системи: MedCouncil AI (MVP та План Розвитку)

Цей документ містить детальний опис архітектури, функціоналу та планів розвитку системи для відповіді на ваші запити щодо MVP, інтеграції даних, візуалізації та оцінки якості.

## 1. Розробка MVP з Ключовим Функціоналом

**Поточний Стан (MVP):**
Ваша система вже реалізує концепцію "Мультиагентного Консиліуму" на базі FastAPI та Google Gemini.

*   **Архітектура:** Клієнт-серверна (React Frontend + FastAPI Backend).
*   **Ядро (Backend):**
    *   `AgentSystem` (`backend/agents.py`): Оркестратор агентів.
    *   **Агенти:**
        1.  **Сімейний Лікар (Triage):** Приймає первинні симптоми, збирає анамнез, визначає напрямок (Фтизіатрія або Інфекційні хвороби).
        2.  **Вузькі Спеціалісти:** Фтизіатр або Інфекціоніст (активуються динамічно на основі рішення сімейного лікаря).
        3.  **Координатор:** Синтезує висновки попередніх агентів у фінальний діагноз та рекомендації.
*   **Дані (Storage):** SQLite (`backend/hospital.db`) для зберігання історії чатів та повідомлень.

**Мінімально Необхідні Доробки для Повноцінного MVP:**
*   **Обробка Помилок:** Додати retry-механізми для API викликів Gemini.
*   **Структурований Вивід:** Гарантувати, що агенти повертають відповіді у JSON форматі для легшого парсингу на фронтенді (особливо для таблиць/графіків).

## 2. Інтеграція Попередньо Опрацьованого Датасету та Моделей

Для покращення точності та спеціалізації системи, пропонується наступний підхід до інтеграції даних:

**А. RAG (Retrieval-Augmented Generation) - Рекомендований Підхід:**
Замість донавчання (fine-tuning) моделі, що є дорогим і складним, використовуйте RAG для надання агентам доступу до вашого медичного датасету.

1.  **Підготовка Даних:**
    *   Очистити ваш датасет (клінічні протоколи, описи хвороб, анонімізовані історії хвороб).
    *   Розбити текст на невеликі фрагменти (chunks).
2.  **Векторизація (Embeddings):**
    *   Використати модель для створення ембеддінгів (наприклад, `text-embedding-004` від Google).
    *   Зберегти вектори у легковагову векторну БД (наприклад, **ChromaDB** або **FAISS**, які можна запустити локально разом з SQLite).
3.  **Інтеграція в `AgentSystem`:**
    *   Модифікувати метод `_call_llm`: перед відправкою промпта, шукати у векторній базі релевантні шматки знань за симптомами пацієнта.
    *   Додавати ці знання у блок `INTERNAL CONTEXT` промпта.

**Б. Статичні Довідники:**
Якщо датасет невеликий (наприклад, таблиця кодів хвороб або ліків), його можна завантажити у пам'ять (JSON/Dict) або SQLite і надавати агентам доступ до пошуку по ньому через інструменти (Function Calling), якщо ви перейдете на агентів з інструментами.

## 3. Візуалізація Отриманих Результатів

Візуалізація робить складні медичні дані зрозумілими. Ось які типи візуалізації можна інтегрувати:

**Типи Візуалізацій:**
*   **Діаграми Впевненості (Confidence Charts):** Стовпчаста діаграма, що показує ймовірність різних діагнозів (наприклад: Туберкульоз - 85%, Пневмонія - 10%).
*   **Динаміка Симптомів:** Лінійний графік зміни стану пацієнта, якщо система аналізує історію кількох візитів.
*   **Таблиці Порівняння:** Порівняння призначених ліків (дозування, протипоказання).

**Технічна Реалізація:**
1.  **Backend (`agents.py`):**
    *   Координатор повинен повертати JSON зі структурою:
        ```json
        {
          "diagnosis": "...",
          "treatment": "...",
          "metrics": [
            {"label": "TB Probability", "value": 0.85},
            {"label": "Pneumonia Probability", "value": 0.15}
          ]
        }
        ```
2.  **Frontend (React):**
    *   Використати бібліотеку **Recharts** або **Chart.js**.
    *   Створити компонент, який рендерить графік, якщо у відповіді є поле `metrics`.

## 4. Оцінка Роботи Прототипу (Метрики)

Для оцінки якості MVP необхідно створити окремий скрипт валідації (`evaluation.py`).

**Метрики Точності:**
1.  **Diagnostic Accuracy (Точність Діагнозу):** % випадків, де фінальний діагноз Координатора співпав з еталонним ("Golden Truth").
2.  **Referral Accuracy (Точність Направлення):** % випадків, де Сімейний Лікар правильно вибрав спеціаліста (Фтизіатр vs Інфекціоніст).
3.  **Hallucination Rate:** Частота генерації неіснуючих ліків або процедур (перевіряється вручну або через порівняння з базою ліків).

**Процедура Оцінки:**
1.  **Golden Dataset:** Створіть файл (CSV/JSON) з парами: `Симптоми -> Правильний Діагноз`.
2.  **Скрипт Оцінки:**
    *   Проходить по кожному запису датасету.
    *   Відправляє симптоми в `AgentSystem`.
    *   Порівнює отриманий результат з еталоном.
    *   Генерує звіт: "Accuracy: 85%, Errors: [Case #12, Case #45]".

---
*Цей опис можна використовувати як основу для технічної документації або презентації вашого проекту.*
